{% extends "base.html" %}
{% load static %}
{% load jsonify %}

{% block content %}
    {% block header %}
    {%  endblock %}
        <form class="form-horizontal" id="linking-form"  method="post">
            {% csrf_token %}
            {%  block main_fields %}
            <div class="row">
                <label for="{{ form.name.id_for_label }}" class="control-label col-sm-3">{{ form.name.label }}</label>
                <div class="preview col-sm-9">
                    {{ form.name }}
                </div>
            </div>
            <div class="row">
                <label for="{{ form.description.id_for_label }}" class="control-label col-sm-3">{{ form.description.label }}</label>
                <div class="preview col-sm-9">
                    {{ form.description }}
                </div>
            </div>
            {%  endblock %}
            <div class="clearfix"></div>
            {%  block datasets %}
            {%  endblock %}
            <fieldset>
                {% if form.name.value %}
                    <legend>Linking Steps</legend>
                    <div id="form-steps-container">
                        {% include "linking/linking_step_form.html" %}
                    </div>
                    <div class="pull-right">
                        <a id="step-create" href="" class="btn btn-primary">Add a new step</a>
                    </div>
               {% endif %}
            </fieldset>
          <div class="form-group preview col-sm-12">
            <button type="submit" class="btn btn-primary">Save</button>
         </div>
       </form>

{% endblock %}

{% block javascript %}
    {{ block.super }}
    <script type="text/javascript">
       var left_data_id = "{{ form.left_data.id_for_label }}";
       var DATASET_COLUMNS_URL = "{% url 'datasets:header' %}";
       var COMPARISON_ARGS = JSON.parse('{{ comparison_args | jsonify }}');
       var header_options = {};
       header_options[left_data_id] = '';
       var transformation_choices = JSON.parse('{{ blocking_transformation_choices | jsonify }}');
       var comparison_choices = JSON.parse('{{ linking_comparison_choices | jsonify }}');
       var comparison_args = JSON.parse('{{ comparison_args | jsonify }}');
    </script>
    <script src="{% static 'js/linking/project_form.js' %}"></script>
{% endblock %}
