{% extends "base.html" %}
{% load static %}
{% load linking_extras %}
{% load jsonify %}

{% block content %}
    <legend><h2>Dataset</h2></legend>
    <div class="row">
            <form id="dataset-form" class="form-horizontal" method="post">
                {% csrf_token %}
                <label for="{{ form.name.id_for_label }}" class="control-label col-sm-3">{{ form.name.label }}</label>
                <div class="preview col-sm-9">
                    {{ form.name }}
                </div>

                <label for="{{ form.title.id_for_label }}" class="control-label col-sm-3">{{ form.title.label }}</label>
                <div class="preview col-sm-9">
                    {{ form.title }}
                </div>

                <label for="{{ form.description.id_for_label }}"
                       class="control-label col-sm-3">{{ form.description.label }}</label>
                <div class="preview col-sm-9">
                    {{ form.description }}
                </div>

                <label for="{{ form.format.id_for_label }}"
                       class="control-label col-sm-3">{{ form.format.label }}</label>
                <div class="preview col-sm-9">
                    {{ form.format }}
                </div>

                <label for="{{ form.url.id_for_label }}" class="control-label col-sm-3">{{ form.url.label }}</label>
                <div class="preview col-sm-9">
                    {{ form.url }}
                </div>

                {% if form.instance.pk %}
                    {{ form.data_types }}
                    <label for="{{ form.index_field.id_for_label }}"
                           class="control-label col-sm-3">{{ form.index_field.label }}</label>
                    <div class="preview col-sm-9">
                        {{ form.index_field }}
                    </div>
                    <label for="{{ form.entity_field.id_for_label }}"
                           class="control-label col-sm-3">{{ form.entity_field.label }}</label>
                    <div class="preview col-sm-9">
                        {{ form.entity_field }}
                    </div>
                {% endif %}
                <div class="col-sm-12">
                    <table id="header-type-table" class="table table-bordered">
                        <thead>
                            <th>Field Name</th>
                            <th class="col-md-2">Field Type</th>
                            <th colspan="5">Sample Data</th>
                        </thead>
                        <tbody>
                        {% for field in columns %}
                            <tr>
                                <th>{{ field }}</th>
                                <td>
                                    <select class="data-type form-control" id="{{ field }}_dtype">
                                    <option value=""></option>
                                        {% for type in COPLUMN_TYPES %}
                                            <option value="{{ type.0 }}">{{ type.1 }}</option>
                                        {% endfor %}
                                    </select>
                                </td>
                                {%  with index=forloop.counter0 %}
                                    {% for row in records %}
                                        <td>{{ row|get_cell:index }}</td>
                                    {% endfor %}
                                {% endwith %}
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div class="form-group preview col-sm-12">
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
    </div>
{% endblock %}
{% block javascript %}
    {{ block.super }}
    <script type="text/javascript">
        var data_types = JSON.parse('{{ data_types | jsonify }}');
        var columns = "{{ columns }}";
        var COPLUMN_TYPES = "{{ COPLUMN_TYPES }}";
        var header_types = JSON.parse('{{ types | jsonify }}');
    </script>
    <script src="{% static 'js/datasets/dataset_form.js' %}"></script>
{% endblock %}
